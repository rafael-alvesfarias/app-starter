<html>
<head>
	<link rel="stylesheet" type="text/css" href="css/style.css">
	<script type="text/javascript" src="js/jquery-1.11.2.js"></script>
	<script type="text/javascript" src="js/navegacao.js"></script>
	<script>
		var executor = require('executorComandos.js');
		var gui = require('nw.gui');
		var win = gui.Window.get();
		var Mustache = require("mustache");
		var fs = require("fs");
		
		win.on('close', function() {
  			this.hide();
  			this.close(true);
		});
		
		win.on('loaded',function(){
			montarApps();
			
			var navegacao = new Navegacao($('#app-1'));
			navegacao
				.adicionarNavegacao(".menu")
				.adicionarNavegacao(".app");
			
			$(document).keydown(navegacao.navegar);

			$(".app").mouseenter(playSound);

			$(".app").on("ganhouSelecao", function(e){
				$(this).addClass("selecionado");
				$("#titulo-app-"+$(this).attr("id").split("-")[1]).css("visibility","visible");
				playSound();
			});

			$(".menu").on("ganhouSelecao", function(e){
				$(this).attr("class", $(this).attr("class") + "-selecionado");
			});

			$(".app").on("perdeuSelecao", function(e){
				$(this).removeClass("selecionado");
				$("#titulo-app-" + $(this).attr("id").split("-")[1]).css("visibility","hidden");
			});

			$(".menu").on("perdeuSelecao", function(e){
				$(this).attr("class", $(this).attr("class").replace("-selecionado",""));
			});
		});

		function fechar(){
			win.close();
		}

		function config(){
			win.close();
			gui.Window.open('configuracoes.html', {
				  fullscreen: true,
				  toolbar: false
			});
		}
		
		function playSound(){
			document.getElementById("som_cursor").play();
		}
		
		function montarApps(){
			var template = $("#template").html();
			var view = JSON.parse(fs.readFileSync('config/apps.json', 'utf8'));
			Mustache.parse(template);
			var rendered = Mustache.render(template, view);
			$("#target").html(rendered);
		}
	</script>
	
	<script id="template" type="x-tmpl-mustache">
		<table>
			<thead>
			<tr>
				{{#apps}}
					<td><div id="titulo-app-{{index}}" style="visibility: hidden;"><h1>{{nome}}</h1></div></td>
				{{/apps}}
			</tr>
			</thead>
			<tbody>
			<tr>
				{{#apps}}
					<td>
						<div class="app button" id="app-{{index}}" onclick="executor('{{local}}').executar();" title="{{nome}}">
							<img src="{{imagem}}">
						</div>
					</td>
				{{/apps}}
			</tr>
			<tbody>
		</table>
	</script>
</head>
<body>
	<audio src="resources/sons/cursor.ogg" id="som_cursor"></audio>
	<div class="menu-superior">
			<div class="menu botao-config" id="menu-1" onclick="config();"></div>
			<div class="menu botao-fechar" id="menu-2" onclick="fechar();"></div>
	</div>
	<div style="clear:both;"></div>
	<div class="apps" id="target"></div>
</body>
</html>